<!doctype html public "-//w3c//dtd html 4.0 transitional//en">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>MIRS2405-ELEC-0002 MIRS2405 エレクトロニクス開発報告書</title>
<link rel=stylesheet href="../../style.css" type="text/css">
<link rel="shortcut icon" href="../../gullc_rogo.jpg" />
<script>
    setInterval("elm=document.getElementById('izutani');if(elm.style.visibility=='visible'){elm.style.visibility='hidden';}else{elm.style.visibility='visible';}",10000)
</script>

</head>

<body bgcolor="#000000" text="#ff00ff" link="#ff0000" vlink="#ffff00" alink="#0000ff">

    <img src="../../gullc_rogo.jpg" width="100">

<table class="table010">
<tr>
<th>名称</th>
<td class="title">MIRS2405 エレクトロニクス開発報告書</td>
</tr>
<tr>
<th>番号</th>
<td class="title">MIRS2405-ELEC-0002</td>
</tr>
</table>
<br>

<table class="table010">
<tr>
<th>版数</th>
<th>最終更新日</th>
<th>作成</th>
<th>承認</th>
<th>改訂記事</th>
</tr>
<tr>
    <td>A01</td>
    <td>2024.11.18</td>
    <td>宇佐見祥</td>
    <td></td>
    <td>初版</td>
</tr>
<tr>
    <td>A02</td>
    <td>2024.12.10</td>
    <td>宇佐見祥</td>
    <td></td>
    <td>主回路モジュール項の追加とゲート基板画像の差し替え</td>
</tr>
<tr>
    <td>A03</td>
    <td>2025.01.31</td>
    <td>宇佐見祥</td>
    <td></td>
    <td>試験結果の追記</td>
</tr>
<tr>
    <td>A04</td>
    <td>2025.02.14</td>
    <td>宇佐見祥</td>
    <td>大沼巧先生</td>
    <td>単体試験に関する負荷条件の追記, 不具合報告書の追加</td>
</tr>
</table>

<br>

<h3>目次</h3>
    <ul>
        <li><a href = "#elec2">1. はじめに</a><br> </li>
        <li><a href = "#elec1">2.基板の製作手順</a><br></li>
        <li><a href = "#elec3">3. サーボモータ電源基板</a><br></li>
        <li><a href = "#elec4">4. PWM・ゲートドライブ基板</a><br></li>
        <li><a href = "#elec5">5.電圧測定基板</a><br></li>
        <li><a href = "#elec6">6.主回路モジュール</a><br></li>
        <li><a href = "#elec7">7.電源系回路の機体への固定</a><br></li>
        <li><a href = "#elec8">8.Raspberry Pi pico用基板</a><br></li>
        <li><a href = "#elec9">9.Arduino用基板</a><br></li>
        <li><a href = "#elec11">11.総括</a><br></li>
    </ul>

<br>
<h2><a name = elec1>1.はじめに</a></h2>
本ドキュメントはMIRS2405 𝔊𝔘𝔏𝔏ℭのエレクトロニクス開発報告書である。<br>
<br>

<h2><a name = elec2>2.基板の製作手順</a></h2>
基板の製作にはKicadを用いた。<br>
先ずは回路図からPCBのパターンを作成する。<br>
PCBパターンが完成したらガーバーファイル(裏面の銅箔部分データと外形データ)及びドリルファイルを出力する。<br>
出力されたファイルを基板加工機に移し、加工を始める。<br>
基板加工機は3台あるうちの真ん中にあるミッツ製のものを使用した。<br>
ただし原点合わせや加工穴深さの設定、工具データの設定等が非常に煩雑だった。<br>
基板加工機の使用方法は技術調査書へ。<br>
<a href="../../rept/num0004a/index.html">基板加工機の使い方リンク</a><br>
使用したファイルはtable.1より参照。<br>
<br>
なお製作した基板はすべて導通チェックを行い不具合がないことを確認している。<br>
そのため項目3,4,5,8,9での導通確認試験は省略する。<br>
<center>
    table.1 加工データファイル<br>
    <table class="table010">
        <tr>
            <th>ファイル</th>
            <th>種類</th>
            <th>詳細</th>
        </tr>
        <tr>
            <td><a href="../files/SRV_PCB/gbr/MIRS2405_ServoDCDC-B_Cu.gbr">MIRS2405_ServoDCDC-B_Cu.gbr</a></td>
            <td>ガーバー</td>
            <td>サーボ電源基板の裏面銅箔部ガーバーデータ</td>
        </tr> 
        <tr>
            <td><a href="../files/SRV_PCB/gbr/MIRS2405_ServoDCDC-Edge_Cuts.gbr">MIRS2405_ServoDCDC-Edge_Cuts.gbr</a></td>
            <td>ガーバー</td>
            <td>サーボ電源基板の外形線ガーバーデータ</td>
        </tr>
        <tr>
            <td><a href="../files/SRV_PCB/drl/MIRS2405_ServoDCDC-PTH.drl">MIRS2405_ServoDCDC-PTH.drl</a></td>
            <td>ドリル</td>
            <td>サーボ電源基板のドリルデータ</td>
        </tr>

        <tr>
            <td><a href="../files/GDC_PCB/gbr/MIRS2405_PWM_GD-B_Cu.gbr">MIRS2405_PWM_GD-B_Cu.gbr</a></td>
            <td>ガーバー</td>
            <td>PWM・ゲートドライブ基板の裏面銅箔部ガーバーデータ</td>
        </tr> 
        <tr>
            <td><a href="../files/GDC_PCB/gbr/MIRS2405_PWM_GD-Edge_Cuts.gbr">MIRS2405_PWM_GD-Edge_Cuts.gbr</a></td>
            <td>ガーバー</td>
            <td>PWM・ゲートドライブ基板の外形線ガーバーデータ</td>
        </tr>
        <tr>
            <td><a href="../files/GDC_PCB/drl/MIRS2405_PWM_GD-PTH.drl">MIRS2405_PWM_GD-PTH.drl</a></td>
            <td>ドリル</td>
            <td>PWM・ゲートドライブ基板のドリルデータ</td>
        </tr>

        <tr>
            <td><a href="../files/OVD_PCB/gbr/MIRS2405_OVD_pcb-B_Cu.gbr">MIRS2405_OVD_pcb-B_Cu.gbr</a></td>
            <td>ガーバー</td>
            <td>電圧測定基板の裏面銅箔部ガーバーデータ</td>
        </tr> 
        <tr>
            <td><a href="../files/OVD_PCB/gbr/MIRS2405_OVD_pcb-Edge_Cuts.gbr">MIRS2405_OVD_pcb-Edge_Cuts.gbr</a></td>
            <td>ガーバー</td>
            <td>電圧測定基板の外形線ガーバーデータ</td>
        </tr>
        <tr>
            <td><a href="../files/OVD_PCB/drl/MIRS2405_OVD_pcb-PTH.drl">MIRS2405_OVD_pcb-PTH.drl</a></td>
            <td>ドリル</td>
            <td>電圧測定基板のドリルデータ</td>
        </tr>
    </table>
</center>
<br>


<h2><a name = elec3>3.サーボモータ電源基板</a></h2>
製作した基板をfig.1, fig.2に示す。<br>
<br>
<center>
    <img src="../picture/サーボモータ電源回路_表面.jpg" width="500"><br>
    fig.1 サーボモータ電源回路　表面<br><br>
    <img src="../picture/サーボモータ電源回路_裏面.jpg" width="500"><br>
    fig.2 サーボモータ電源回路　裏面<br><br>
</center>
<br>
バッテリー入力および電源出力はXT60コネクタを使用した。<br>
両面生基板を加工したが、表面は導通させないためヤスリで削った。<br>
単体試験は出力側に比較的抵抗値の大きな抵抗を接続して行った。<br>
※最大出力電流5Aに対して試験時の電流はmAオーダーである。これは軽負荷とも呼べないくらい負荷が小さいので無負荷とする。<br>
そのため無負荷時電圧で合否を判断することとした。<br>
単体試験の結果はtable.2に示す。<br>
<center>
    table.2 サーボモータ電源回路 単体試験結果<br>
    <table class="table010">
        <tr>
            <th>試験内容</th>
            <th>合格基準</th>
            <th>試験結果</th>
            <th>合否判断</th>
        </tr>
        <tr>
            <td>出力電圧</td>
            <td>無負荷時の出力電圧が7.0~7.4V以内に収まっていること。</td>
            <td>7.2V程度の出力だった。</td>
            <td>合格</td>
        </tr> 
    </table>
</center>

<br>
<h2><a name = elec4>4.PWM・ゲートドライブ基板</a></h2>
製作した基板をfig.3, fig.4に示す。<br>
<br>
<center>
    <img src="../picture/PWM基板_表面.jpg" width="500"><br>
    fig.3 PWM・ゲートドライブ基板　表面<br><br>
    <img src="../picture/PWM基板_裏面.jpg" width="500"><br>
    fig.4 PWM・ゲートドライブ基板　裏面<br><br>
</center>
基板上面右側の5穴,3穴は、ほかのデバイスとSPIまたはI2Cにて通信するための準備として加工した部分である。<br>
現在はPWM基板と他のマイコン間での通信はしない設計のため、XHコネクタは未実装としている。<br>
サーボ電源基板と同じくヤスリで削った。<br>
四隅に銅箔部が残っているが回路に影響はしないためこのままとしている。<br>
単体試験の結果はtable.3に示す。<br>
<center>
    table.3 PWM・ゲートドライブ基板 単体試験結果<br>
    <table class="table010">
        <tr>
            <th>試験内容</th>
            <th>試験対象</th>
            <th>負荷条件</th>
            <th>合格基準</th>
            <th>試験結果</th>
            <th>合否判断</th>
        </tr>
        <tr>
            <td>ゲート信号のチェック</td>
            <td>主回路全体</td>
            <td>入力電圧24V,主回路の負荷抵抗10[W]51[Ω]</td>
            <td>MOSFETが正常にターンオン・ターンオフできること。</td>
            <td>ゲート信号が出力され、MOSFETを正常にターンオン・ターンオフできることが確認できた。<a href="../picture/ゲート信号波形.jpg"><img src="../picture/ゲート信号波形.jpg" width="200"></a><br>
            ゲート信号波形には立ち上がりでリンギングが見られる。</td>
            <td>合格</td>
        </tr>
        <tr>
            <td>主回路の電圧測定回路</td>
            <td>基板単体</td>
            <td>無負荷</td>
            <td>マイコンが電圧を正常に読み取ることができること。</td>
            <td>最大±0.2V程度の誤差で読み取ることができた。</td>
            <td>合格</td>
        </tr>
        <tr>
            <td>電圧のPI制御</td>
            <td>主回路全体</td>
            <td>JC-578VA, モーターに負荷は取り付けない</td>
            <td>出力電圧を12Vで維持できること。</td>
            <td>制御を正常に行うことができた。</td>
            <td>合格</td>
        </tr>
        <tr>
            <td>電圧のPI制御</td>
            <td>主回路全体</td>
            <td>KS5N-IG36P, モーターに負荷は取り付けない</td>
            <td>出力電圧を12Vで維持できること。</td>
            <td>制御を正常に行うことができた。</td>
            <td>合格</td>
        </tr>
        <tr>
            <td>電圧のPI制御</td>
            <td>主回路全体</td>
            <td>RS540SH, モーターに負荷は取り付けない</td>
            <td>出力電圧を12Vで維持できること。</td>
            <td>マイコンにリセットがかかり制御を行うことができなかった。</td>
            <td>不合格</td>
        </tr>
    </table>
</center>
基板単体での動作に問題はなかったが、モーター(RS540)を接続して動作させると電源制御マイコンにリセットがかかることが分かった。<br>
電源基板の入力電圧をオシロスコープで観測すると電圧降下が起こっていることが分かった。<br>
直流安定化電源では電流制限がかかっていたため、突入電流による電圧降下が原因であると考えた。<br>
そのため入力側のXT60コネクタにコンデンサ(470μF,50V)を接続することで問題を解消している。<br>
念のためRS540はソフトスタートできるようにソフト側でも対応をしてもらった。<br>
不具合報告書を下に示す。<br>
<address>
    <a href="https://www2.denshi.numazu-ct.ac.jp/mirsdoc2/mirs2405/elec/files/faultreport_MIRS2405_elec.pdf" target="_self">ゲートドライブ基板不具合報告書</a>
</address>

<h2><a name = elec5>5.電圧測定基板</a></h2>
この基板は主回路の出力電圧をフィードバックするためのものである。<br>
製作した基板をfig.5, fig.6に示す。<br>
<br>
<center>
    <img src="../picture/電圧測定基板_表面.jpg" width="300"><br>
    fig.5 電圧測定基板　表面<br><br>
    <img src="../picture/電圧測定基板_裏面.jpg" width="300"><br>
    fig.6 電圧測定基板　裏面<br><br>
</center>


<h2><a name = elec6>6.主回路モジュール</a></h2>
製作した基板をfig.7,fig8に示す。<br>
<br>
<center>
    <img src="../picture/主回路モジュール前面.jpg" width="500"><br>
    fig.7 主回路モジュール前面<br><br>
    <img src="../picture/主回路モジュール後面.jpg" width="500"><br>
    fig.8 主回路モジュール後面<br><br>
</center>
主回路モジュールは動作試験で使用したが、実際のロボットへの実装については次の項目に記載する。<br>

<h2><a name = elec7>7.電源系回路の機体への固定</a></h2>
製作した回路はロボットの左側のスペースに固定した。固定の様子をfig.9, fig10に示す。<br>
<br>
<center>
    <img src="../picture/MD段.jpg" width="500"><br>
    fig.9 固定の様子(上)<br><br>
    <img src="../picture/左側回路.jpg" height="500"><br>
    fig.10 固定の様子(下)<br><br>
</center>

<h2><a name = elec8>8.Raspberry Pi pico用基板</a></h2>
基板の外見をfig.11に示す。<br>
<center>
    <img src="../picture/ラズピコ基板.png" width="500"><br>
    fig.11 固定の様子(上)<br><br>
</center>
基板加工のミスで一部削れていない部分があったため、リューターを用いて削った。<br>
<br>

<h2><a name = elec9>9.Arduino用基板</a></h2>
基板の外見をfig.12に示す。<br>
<center>
    <img src="../picture/Arduino基板.png" width="500"><br>
    fig.12 固定の様子(上)<br><br>
</center>

<h2><a name = elec10>10.電源回路制御プログラム</a></h2>
電源回路の制御にはPICマイコン(PIC16F1938)を使用している。<br>
マイコンのピン配置をfig.13に示す。<br>
<center>
    <img src="../picture/PICピン.png" width="250"><br>
    fig.13 ピン配置<br><br>
</center>
PWM周波数は15.625kHzとしている。プログラムは以下のURLに示す。<br>
<address>
    <a href="https://www2.denshi.numazu-ct.ac.jp/mirsdoc2/mirs2405/elec/files/mirs_1938_buck_converter.X.zip" target="_self">電源制御プログラムのzipファイル</a>
</address>
<address>
    <a href="https://github.com/puwaer/mirs2405/tree/main/program/PIC/projects/mirs_1938_buck_converter.X" target="_self">電源制御プログラム(github)</a>
</address>


<h2><a name = elec11>11.総括</a></h2>
モータを回転させたときの電圧降下を考慮しておらず、部品の追加が必要になってしまった。<br>
メカとの連携不足で配線スペースに余裕がなく、配線長も無駄に長くなってしまった。<br>
各パート間での連携がとても大切だと感じた。<br>
ロボットを動かし、発表に耐えられる電源を作ることができたので良かった。<br>

<br><br>


<hr>

<address>
    <a href="https://www2.denshi.numazu-ct.ac.jp/mirsdoc2/mirs2405/" target="_self">MIRS2405ドキュメント管理台帳へ</a>
</address>


</BODY></html>